<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:mycharts="http://xmlns.jcp.org/jsf/composite/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <p:commandButton value="Add widget"
                     oncomplete="PF('chartSettingDialog').show()"
                     style="margin-top:10px;"/>
    <h:panelGrid columns="1" cellpadding="0" rendered="#{chartBean.chartConfigs.size()>0}">
        <c:forEach items="#{chartBean.chartConfigs}" var="chart">
            <mycharts:mychart id="component#{chart.chartId}"
                              chartOptions="#{chart.chartConfig}"
                              requestDataOptions="#{chart.requestDataConfig}"
                              refreshInterval="#{chart.refreshInterval}"/>
        </c:forEach>
    </h:panelGrid>

    <p:dialog header="Chart settings" widgetVar="chartSettingDialog">
        <!--<h:panelGroup layout="block" id="alertBlock" class="alert-block">-->
        <!--<p:messages id="messages" showDetail="true" closable="true" globalOnly="true" showIcon="false"-->
        <!--styleClass="alert"/>-->
        <!--<p:message for="object" display="text" styleClass="alert"/>-->
        <!--<p:message for="subObject" display="text" styleClass="alert"/>-->
        <!--<p:message for="metric" display="text" styleClass="alert"/>-->
        <!--</h:panelGroup>-->

        <h:panelGrid id="sub" columns="2" cellpadding="0">
            <h:outputLabel for="refreshInterval" value="Refresh interval(minutes):"/>
            <p:inputText id="refreshInterval" value="#{chartBean.refreshInterval}"/>
            <h:outputLabel for="object" value="Object:"/>
            <p:selectCheckboxMenu id="object"
                                  value="#{chartBean.selectedSmartObjects}"
                                  converter="smartObjectConverter"
                                  label="Select object"
                                  filter="true"
                                  filterMatchMode="startsWith"
                                  onHide="executeOnOnhide()">
                <!--required="true"-->
                <!--requiredMessage="The object is required!">-->
                <f:selectItems value="#{chartBean.smartObjects}"
                               var="smartObject"
                               itemValue="#{smartObject}"
                               itemLabel="#{smartObject.name}"/>
                <!--<p:clientValidator/>-->
            </p:selectCheckboxMenu>
            <h:panelGroup id="subObjectLabel">
                <h:outputLabel for="subObject" value="Sub object:" rendered="#{not empty chartBean.subObjects}"/>
            </h:panelGroup>
            <h:panelGroup id="subObjectSelect">
                <p:selectCheckboxMenu id="subObject"
                                      value="#{chartBean.selectedSubObjects}"
                                      converter="smartObjectConverter"
                                      label="Select subobject"
                                      filter="true"
                                      filterMatchMode="startsWith"
                                      onHide="showTitle()"
                                      rendered="#{not empty chartBean.subObjects}">
                    <!--required="#{not empty chartBean.subObjects}"-->
                    <!--requiredMessage="The subobject is required!">-->
                    <!--<p:clientValidator/>-->
                    <f:selectItems value="#{chartBean.subObjects}"
                                   var="smartObject"
                                   itemValue="#{smartObject}"
                                   itemLabel="#{smartObject.name}"/>
                </p:selectCheckboxMenu>
            </h:panelGroup>
            <h:outputLabel for="metric" value="Metric spec:"/>
            <p:selectCheckboxMenu id="metric"
                                  value="#{chartBean.selectedMetricSpecs}"
                                  converter="metricSpecConverter"
                                  label="Select metric"
                                  filter="true"
                                  filterMatchMode="startsWith"
                                  onHide="showTitle()">
                <!--required="true"-->
                <!--requiredMessage="The metric is required!">-->
                <f:selectItems value="#{chartBean.metricSpecs}"
                               var="metricSpec"
                               itemValue="#{metricSpec}"
                               itemLabel="#{metricSpec.specName}"/>
                <!--<p:clientValidator/>-->
            </p:selectCheckboxMenu>
            <h:panelGroup id="titleLabel">
                <h:outputLabel for="chartName"
                               value="Chart title:"
                               rendered="#{chartBean.isRendered()}"/>
            </h:panelGroup>
            <h:panelGroup id="titleInput">
                <p:inputText id="chartName"
                             value="#{chartBean.chartTitle}"
                             rendered="#{chartBean.isRendered()}"/>

            </h:panelGroup>
        </h:panelGrid>
        <p:commandButton value="Submit"
                         action="#{chartBean.addChart()}"
                         update="centerForm"
                         style="margin-top:10px;">
            <!--validateClient="true"-->
            <!--immediate="true"-->

        </p:commandButton>
    </p:dialog>
    <p:remoteCommand name="executeOnOnhide"
                     update="subObjectLabel subObjectSelect titleLabel titleInput"
                     action="#{chartBean.changeSelectObject}"/>
    <p:remoteCommand name="showTitle"
                     update="subObjectLabel subObjectSelect titleLabel titleInput"/>

</ui:composition>
