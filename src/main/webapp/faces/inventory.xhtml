<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

<h2>Inventory</h2>
<p:growl id="growl"/>
<p:outputPanel id="renderInventoryMsg">
    <h:outputLabel rendered="#{empty inventoryBean.rootNode}" value="Data is not received"/>
</p:outputPanel>
<br/>
<p:commandButton value="Get inventory" action="#{inventoryBean.addTaskInventory}" styleClass="btn"/>

<p:outputPanel id="inventory">
    <p:organigram id="organigram" rendered="#{not empty inventoryBean.rootNode}" widgetVar="organigram"
                  value="#{inventoryBean.rootNode}" var="node"
                  selection="#{inventoryBean.selectedNode}">
        <p:ajax event="select" process="@this" update="@form:growl" listener="#{inventoryBean.onSelectNode}"/>
        <p:ajax event="contextmenu" process="@this" update="@form:growl"
                listener="#{inventoryBean.onClickContextMenu}"/>
        <c:forEach items="#{inventoryBean.objectTypes}" var="type">
            <p:organigramNode type="#{type}"
                              styleClass="#{type} #{(node.isLeaf())? 'leaf' : ''}"
                              icon="#{type}"
                              iconPos="left"
                              skipLeafHandling="true">
                <h:outputText value="#{node.data.name}"/>
            </p:organigramNode>
        </c:forEach>
    </p:organigram>

    <c:forEach items="#{inventoryBean.objectTypes}" var="type">
        <p:contextMenu for="organigram" nodeType="#{type}">
            <p:menuitem value="View detail" icon="ui-icon-search"
                        update="@form:info" oncomplete="PF('infoDialog').show()"/>
            <p:menuitem value="Alarms" action="#{navigationBean.setPageName('alarms/alarmlist')}" update=":centerForm"
                        actionListener="#{alarmListBean.showObjectAlarms(inventoryBean.getSelectedObjectId())}">

            </p:menuitem>
        </p:contextMenu>
    </c:forEach>
</p:outputPanel>
<p:dialog position="center" header="Device info" id="infoDialog" widgetVar="infoDialog" showEffect="fade"
          hideEffect="fade" resizable="false" autoUpdate="true">
    <p:outputPanel id="info">
        <p:panelGrid columns="2" styleClass="ui-noborder">
            <f:facet name="header">
                <p:graphicImage name="images/inventory/#{inventoryBean.selectedObject.objectType.name}.png"
                                width="200px" style="text-align: center !important;"/>
            </f:facet>
            <p:outputLabel value="Name:" styleClass="label"/>
            <p:outputLabel value="#{inventoryBean.selectedObject.name}"/>
            <p:outputLabel value="Description:" styleClass="label"/>
            <p:outputLabel value="#{inventoryBean.selectedObject.description}"/>
            <p:outputLabel value="Current alarms:" styleClass="label"/>
            <p:row>
                <c:if test="#{inventoryBean.selectedObjectAlarms == null}">
                    <p:outputLabel/>
                </c:if>
                <c:forEach items="#{inventoryBean.selectedObjectAlarms}" var="alarm">
                    <p:commandLink value="#{alarm.alarmName}"
                                   action="#{navigationBean.setPageName('alarms/alarm')}"
                                   update=":centerForm" oncomplete="PF('infoDialog').hide(); return true;">
                        <f:setPropertyActionListener value="#{alarm}" target="#{alarmBean.selectedAlarm}"/>
                    </p:commandLink>
                    <h:outputText value="  "/>
                </c:forEach>
            </p:row>
            <p:outputLabel value="Catalog" styleClass="label"/>
            <p:outputLabel value="#{inventoryBean.selectedObject.catalog.catalogName}"/>
            <!--<p:selectOneMenu binding="#{catalogSelect}" value="#{inventoryBean.selectedObject.catalog}"
                                 filter="true" filterMatchMode="startsWith" converter="catalogConverter" styleClass="inventory-dialog-select">
                    <p:ajax event="change" updatePolicy="@form:info" listener="#{inventoryBean.onChangeCatalog(catalogSelect.label)}"/>
                    <f:selectItem itemLabel="+ Add catalog"/>
                    <f:selectItem itemLabel="/" itemValue="#{inventoryBean.rootCatalog}"/>
                    <f:selectItems var="item" value="#{inventoryBean.objectsCatalogs}"
                                   itemLabel="#{item.catalogName}" itemValue="#{item}"/>
                </p:selectOneMenu>

            <p:outputLabel rendered="#{(inventoryBean.adding == true)}" value="New catalog name:" styleClass="label"/>
            <p:inputText rendered="#{(inventoryBean.adding == true)}" value="#{inventoryBean.addedCatalog.catalogName}"/>
           -->
        </p:panelGrid>
    </p:outputPanel>
    <br/>
    <p:commandButton value="Save" action="#{inventoryBean.saveChanges}" update=":centerForm" styleClass="btn"
                     icon="fa fa-save"/>

</p:dialog>

<p:remoteCommand name="updateInventory" update="centerForm:inventory centerForm:renderInventoryMsg"
                 actionListener="#{inventoryBean.init}"/>
<script type="text/javascript">
    updateContent(window.location + 'updateInventory?houseId=' + '${currentUserHomesBean.currentHome.smartHomeId}', "updateInventory");
</script>


</html>