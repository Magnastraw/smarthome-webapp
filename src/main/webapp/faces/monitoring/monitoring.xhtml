<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

<p:outputPanel id="monitoring">
    <h2>Information</h2>

    <p:panel id="eventHistoryPanel" header="Event history" toggleable="true" toggleOrientation="vertical"
             collapsed="true">
        <h:outputText value="Здесь будет таблица"/>
    </p:panel>


    <p:panel id="notificationPanel" header="Notifications" toggleable="true" toggleOrientation="vertical"
             collapsed="true">
        <p:dataTable id="notificationsDT" widgetVar="notificationsTable" var="notification"
                     value="#{notificationBean.notifications}" paginator="true" paginatorPosition="bottom"
                     rows="5" rowsPerPageTemplate="5,10,15"
                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     filteredValue="#{notificationBean.filteredNotifications}"
                     emptyMessage="No objects found with given criteria">
            <p:column headerText="Text" style="width: 21%" filterBy="#{notification.notificationName}"
                      filterMatchMode="contains" filterStyleClass="filter">
                <h:outputText value="#{notification.notificationName}"/>
            </p:column>
            <p:column headerText="Time" style="width: 15%" styleClass="column-time" filterBy="#{notification.time}"
                      filterFunction="#{notificationBean.filterByDate}">
                <f:facet name="filter">
                    <p:calendar id="notificationTimeFilter" pattern="dd.MM.yy HH:mm:ss" readonly="false"
                                styleClass="filter-date"
                                timeInput="true" navigator="true" mask="true" showButtonPanel="true">
                        <p:ajax event="dateSelect" oncomplete="PF('notificationsTable').filter()"/>
                        <p:ajax event="change" listener="#{notificationBean.onChange('notificationTimeFilter')}"
                                oncomplete="PF('notificationsTable').filter()"/>
                    </p:calendar>
                </f:facet>
                <h:outputText value="#{notification.time}">
                    <f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss"/>
                </h:outputText>
            </p:column>
            <p:column headerText="Object" style="width: 20%" filterBy="#{notification.notificationObject}"
                      filterMatchMode="contains" filterStyleClass="filter">
                <h:outputText value="#{notification.notificationObject}"/>
            </p:column>
            <p:column headerText="Home" style="width: 20%" filterBy="#{notification.smartHome}"
                      filterMatchMode="contains" filterStyleClass="filter">
                <h:outputText value="#{notification.smartHome}"/>
            </p:column>
            <p:column headerText="Channel" style="width: 12%" filterBy="#{notification.channel}" filterMatchMode="exact">
                <f:facet name="filter">
                    <p:selectOneMenu onchange="PF('notificationsTable').filter()">
                        <f:selectItem itemLabel="Select One" itemValue="#{null}" noSelectionOption="true"/>
                        <f:selectItems value="#{notificationBean.channels}"/>
                    </p:selectOneMenu>
                </f:facet>
                <h:outputText value="#{notification.channel}"/>
            </p:column>
            <p:column headerText="Status" style="width: 12%" filterBy="#{notification.notificationStatus}" filterMatchMode="exact">
                <f:facet name="filter">
                    <p:selectOneMenu onchange="PF('notificationsTable').filter()">
                        <f:selectItem itemLabel="Select One" itemValue="#{null}" noSelectionOption="true"/>
                        <f:selectItems value="#{notificationBean.statuses}"/>
                    </p:selectOneMenu>
                </f:facet>
                <h:outputText value="#{notification.notificationStatus}"/>
            </p:column>
        </p:dataTable>
    </p:panel>


    <p:panel id="alarmPanel" header="Alarms" toggleable="true" toggleOrientation="vertical"
             collapsed="true">
        <p:outputPanel styleClass="button-panel ui-noborder">
            <p:commandButton action="#{navigationBean.setPageName('charts/dashboardManagement')}" update=":centerForm"
                             value="Metric dashboard" styleClass="to-dashboard" icon="fa fa-bar-chart"/>
            <p:commandButton action="#{alarmListBean.setClearSeverity}" oncomplete="PF('alarmsTable').unselectAllRows()"
                             update=":centerForm:alarmsDT"
                             value="Clear alarms" styleClass="to-dashboard"/>
        </p:outputPanel>
        <p:breadCrumb id="alarmPath" homeDisplay="text">
            <p:menuitem icon="fa fa-home" actionListener="#{alarmListBean.getRootAlarms}" update=":centerForm"/>
            <c:forEach items="#{alarmListBean.alarmPath}" var="alarm">
                <p:menuitem value="#{alarm.alarmName}" actionListener="#{alarmListBean.expand(alarm)}"
                            update=":centerForm"/>
            </c:forEach>
        </p:breadCrumb>
        <p:dataTable id="alarmsDT" widgetVar="alarmsTable" value="#{alarmListBean.currentAlarms}" var="alarm"
                     sortBy="#{alarm.startTime}" sortOrder="descending" rowKey="#{alarm.alarmId}"
                     selection="#{alarmListBean.selectedAlarms}" paginator="true" rows="5" rowsPerPageTemplate="5,10,15"
                     paginatorPosition="bottom"
                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     filteredValue="#{alarmListBean.filteredAlarms}"
                     emptyMessage="No objects found with given criteria">
            <p:column selectionMode="multiple" styleClass="column-checkbox"/>
            <p:column headerText="Name" sortBy="#{alarm.alarmName}" filterBy="#{alarm.alarmName}"
                      filterMatchMode="startsWith" filterStyleClass="filter">
                <p:commandLink rendered="#{alarm.subAlarms.size() != 0}" styleClass="fa table-name arrow"
                               title="#{tableEntity.name}"
                               value="#{tableEntity.name}" action="#{alarmSpecsBean.onSelect(tableEntity)}"
                               update=":centerForm"/>
                <p:commandLink styleClass="fa table-name" value="#{alarm.alarmName}"
                               action="#{alarmListBean.onSelect(alarm)}" update=":centerForm"
                               title="#{alarm.alarmName}"/>
            </p:column>
            <p:column headerText="Description" styleClass="column" sortBy="#{alarm.alarmDescription}"
                      filterBy="#{alarm.alarmDescription}" filterMatchMode="startsWith" filterStyleClass="filter">
                <h:outputText value="#{alarm.alarmDescription}"/>
            </p:column>
            <p:column headerText="Object" styleClass="column" sortBy="#{alarm.object.name}"
                      filterBy="#{alarm.object.name}" filterMatchMode="startsWith" filterStyleClass="filter">
                <h:outputText value="#{alarm.object.name}" title="#{alarm.object.name}"/>
            </p:column>
            <p:column headerText="Subobject" styleClass="column" sortBy="#{alarm.subobject.name}"
                      filterBy="#{alarm.subobject.name}" filterMatchMode="startsWith" filterStyleClass="filter">
                <h:outputText value="#{alarm.subobject.name}"/>
            </p:column>
            <p:column headerText="Start time" styleClass="column-time" sortBy="#{alarm.startTime}"
                      filterBy="#{alarm.startTime}" filterFunction="#{alarmListBean.filterByDate}">
                <f:facet name="filter">
                    <p:calendar id="startTimeFilter" pattern="dd.MM.yy" readonly="false" styleClass="filter-date"
                                timeInput="true" navigator="true" mask="true" showButtonPanel="true">
                        <p:ajax event="dateSelect" oncomplete="PF('alarmsTable').filter()"/>
                        <p:ajax event="change" listener="#{alarmListBean.onChange('startTimeFilter')}"
                                oncomplete="PF('alarmsTable').filter()"/>
                    </p:calendar>
                </f:facet>
                <h:outputText value="#{alarm.startTime}">
                    <f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss"/>
                </h:outputText>
            </p:column>
            <p:column headerText="End time" styleClass="column-time" sortBy="#{alarm.endTime}"
                      filterBy="#{alarm.endTime}" filterFunction="#{alarmListBean.filterByDate}">
                <f:facet name="filter">
                    <p:calendar id="endTimeFilter" pattern="dd.MM.yy" readonly="false" styleClass="filter-date"
                                timeInput="true" navigator="true" mask="true" showButtonPanel="true">
                        <p:ajax event="dateSelect" oncomplete="PF('alarmsTable').filter()"/>
                        <p:ajax event="change" listener="#{alarmListBean.onChange('endTimeFilter')}"
                                oncomplete="PF('alarmsTable').filter()"/>
                    </p:calendar>
                </f:facet>
                <h:outputText value="#{alarm.endTime}">
                    <f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss"/>
                </h:outputText>
            </p:column>
            <p:column headerText="Severity"
                      styleClass="column-time #{alarmListBean.setStyleClass(alarm.severity.ordinal())}"
                      sortBy="#{alarm.severity}" filterBy="#{alarm.severity}">
                <f:facet name="filter">
                    <p:selectOneMenu onchange="PF('alarmsTable').filter()" styleClass="filter-select">
                        <f:selectItem/>
                        <f:selectItems value="#{alarmListBean.severities}"/>
                    </p:selectOneMenu>
                </f:facet>
                <h:outputText value="#{alarm.severity}"/>
            </p:column>
            <!--<p:column headerText="Severity change" styleClass="column" sortBy="#{alarm.severityChangeTime}">
                <h:outputText value="#{alarm.severityChangeTime}">
                    <f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss"/>
                </h:outputText>
            </p:column>-->
            <p:column headerText="Option" styleClass="column-detail">
                <p:commandLink value="Details" action="#{navigationBean.setPageName('alarms/alarm')}"
                               update=":centerForm">
                    <f:setPropertyActionListener value="#{alarm}" target="#{alarmBean.selectedAlarm}"/>
                </p:commandLink>
            </p:column>
        </p:dataTable>
    </p:panel>
</p:outputPanel>
</html>
